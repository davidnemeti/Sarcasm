<#@ template debug="true" hostSpecific="true" language="C#" #>
<#@ output extension="generated.cs" #>
<#@ assembly Name="System.Core" #>
<#@ import namespace="System" #>
<#@ import namespace="System.IO" #>
<#@ import namespace="System.Diagnostics" #>
<#@ import namespace="System.Linq" #>
<#@ import namespace="System.Collections.Generic" #> 

using System;
using System.IO;
using System.Linq;
using Microsoft.VisualStudio.TestTools.UnitTesting;

using Irony;
using Irony.Ast;
using Irony.Parsing;
using Sarcasm;
using Sarcasm.Ast;
using Sarcasm.Unparsing;

using MiniPL.DomainModel;

using Grammar = Sarcasm.Ast.Grammar;

namespace Sarcasm.UnitTest
{
    public partial class ParserTest
    {
<#
	string testFileDirPath = Host.ResolvePath(@"..\Test files");
    foreach (string filePath in Directory.GetFiles(testFileDirPath))
    {
        GenerateTestMethod(filePath, typesafe: true);
        GenerateTestMethod(filePath, typesafe: false);
    }
#>
	}
}

<#+
void GenerateTestMethod(string filePath, bool typesafe)
{
    string extension = Path.GetExtension(filePath);
    string filename = Path.GetFileName(filePath);
    string parseTestMethodName = "Parse_" + Path.GetFileNameWithoutExtension(filePath) + (typesafe ? "_TS" : string.Empty);
    string parseMethodName = typesafe ? "ParseFileSaveAstAndCheckTS" : "ParseFileSaveAstAndCheck";

    if (extension == ".mplp")
    {
#>
        [TestMethod]
        [TestCategory(category)]
        public void <#= parseTestMethodName #>()
        {
            <#= parseMethodName #>(B.Program, "<#= filename #>");
        }

<#+
    }
    else if (extension == ".expr")
    {
#>
        [TestMethod]
        [TestCategory(category)]
        public void <#= parseTestMethodName #>()
        {
            <#= parseMethodName #>(B.Expression, "<#= filename #>");
        }

<#+
    }
    else
        throw new ApplicationException(string.Format("Unknown file extension: \"{0}\"", extension));
}
#>
